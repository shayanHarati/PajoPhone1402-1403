@model CreateOrEditProductViewModel

<div class="bg-slate-950 " style="height: max-content;">
    <div class="container   md:w-6/12 md:mx-auto  md:p-2">
        <form enctype="multipart/form-data" asp-action="CreateOrEditProduct" asp-controller="Store" method="post" class="flex border-2 border-slate-600 lg:m-3 border-dotted flex-col xl:flex-row lg:justify-between">
            <div>
                <div class="flex flex-col">
                    <label class="m-2 text-white" asp-for="Image"></label>
                    @if (Model.ImageProduct == null)
                    {
                        <input  class=" p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300" type="file" asp-for="Image"/>
                        <input asp-for="ImageProduct" value="Default.jpg" type="hidden"/>
                    }
                    else
                    {
                        <img src="@("/images/" + Model.ImageProduct)" />
                        <input class=" p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300"  asp-for="Image"/>
                        <input asp-for="ImageProduct" type="hidden"/>
                    }
                    <span class="error" asp-validation-for="Image" ></span>
                </div>
                <div  class="flex flex-col">
                    <div class="flex flex-col">
                        <label class="m-2 text-white" asp-for="ProductName" for="Name"></label>
                        <input class="p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300" asp-for="ProductName" id="Name" type="text">
                        <span class="error" asp-validation-for="ProductName"></span>
                    </div>
                    <div class="flex flex-col">
                        <label class="m-2 text-white" asp-for="ProductPrice" for="Price"></label>
                        <input  class="numeric p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300" asp-for="ProductPrice" id="demo" type="text" min="0">
                        <span class="error" asp-validation-for="ProductPrice"></span>
                    </div>
                    <div class="flex flex-col">
                        <label class="m-2 text-white" asp-for="ProductColor" for="Color"></label>
                        <input class="p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300" asp-for="ProductColor" id="Color" type="text">
                        <span class="error" asp-validation-for="ProductColor"></span>
                    </div>
                            
                </div>
                <div id="ProductAtt">
                    @for (int field = 0; field < Model.Dynamics.Count(); field++)
                    {
                        <div class="flex flex-col">
                            <label class="m-2 text-white"  for="Color">@Model.Dynamics[field].Field.FieldTitle</label>
                            <input class="p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300" asp-for="Dynamics[field].Value" id="Color" type="text">
                            <input asp-for="Dynamics[field].FieldId">
                            @* <span class="error" asp-validation-for="ProductColor"></span> *@
                        </div>
                    }
                </div>
            </div>
            
            <div class="flex flex-col md:justify-around">
                <div class="flex flex-col mb-2">
                    <label class="m-2 text-white" asp-for="ProductDescription" for="Description"></label>
                    <textarea class="bg-slate-950 md:w-80 xs:mx-0 md:h-80 rounded border-2 border-slate-300 text-slate-300 w-11/12  m-2 md:mx-auto" style="resize: none;" asp-for="ProductDescription" id="Description"></textarea>
                    <span class="error" asp-validation-for="ProductDescription"></span>
                </div>
                <div class="flex flex-col text-white md:justify-around">
                    <partial name="CategoriesRadio" for="CategoryList"/>
                </div>
                <div class="flex flex-col">
                    @if (Model != null)
                    {
                        <input  type="hidden" asp-for="Id"/>
                        <button class="hover:bg-slate-600 w-11/12 m-2 p-1 rounded border-2 text-slate-300 hover:text-white border-slate-300" type="submit">@ViewBag.state</button>
                    }
                    else
                    {
                        <button class="hover:bg-slate-600 w-11/12 m-2 p-1 rounded border-2 text-slate-300 hover:text-white border-slate-300" type="submit" >@ViewBag.state</button>
                    }
                </div>
            </div>
        </form>
    </div>
</div>
@section Scripts
{
    <script src="/js/AutomaticLists.js"></script>
    <script src="/js/MoneySeprator.js"></script>
    <script >
        
        function make_dynamic(status,e){
            
            if (status){
              var url=  "/Field/GetAllFields/"+$(rad[e]).val()
            }else{
                debugger
                if ($("div.ul input:radio:checked").length!=0){
                    var url= "/Field/GetAllFields/"+$("div.ul input:radio:checked").val()
                }else{
                    return 0;
                }
            }
            $.ajax({
            url:url,
            methode:"GET"
            }).done((res)=>{
                     console.log($(res)[0]["dynamicFields"])
                                $($(res)[0]["dynamicFields"]).each((elm)=>{
                                    var div = document.createElement("div")
                                    $(div).addClass("flex flex-col")
                                    var label = document.createElement("label")
                                    $(label).addClass("m-2 text-white")
                                    $(label).text($($(res)[0]["dynamicFields"][elm]).prop("fieldTitle"))
                                    $(div).append(label)
                                    var input=document.createElement("input");
                                    $(input).attr("name","Dynamics["+elm+"].Value")
                                    $(input).addClass("p-2 m-2 w-11/12 bg-slate-950 rounded border-2 border-slate-300 text-slate-300")
                                    if ($($(res)[0]["dynamicFields"][elm]).prop("type")==2){
                                        $(input).attr("type","number");
                                    }else if ($($(res)[0]["dynamicFields"][elm]).prop("type")==1){
                                        // money
                                        $(input).attr("type","text");
                                    }else if ($($(res)[0]["dynamicFields"][elm]).prop("type")==0){
                                         // string
                                         $(input).attr("type","text");
                                     }
                                    else if ($($(res)[0]["dynamicFields"][elm]).prop("type")==3){
                                         // date
                                         $(input).attr("type","datetime");
                                     }
                                
                                    $(div).append(input)
                                    var field_id_input=document.createElement("input")
                                    $(field_id_input).attr("name","Dynamics["+elm+"].FieldId")
                                    $(field_id_input).val($($(res)[0]["dynamicFields"][elm]).prop("id"))
                                    $(field_id_input).attr("type","hidden")
                                    $(div).append(field_id_input)
                                    console.log(div)
                                    $("#ProductAtt").append(div)
                                })
                })
           
        }
        
        var rad = $("div.ul input:radio")
        // $(document).ready(()=>{
        //     make_dynamic(false)
        //     })
        rad.each((e)=>{
            $(rad[e]).change((el)=>{
                $("#ProductAtt").empty()
                make_dynamic(true,e)
                })
            })
        
    </script>
}
